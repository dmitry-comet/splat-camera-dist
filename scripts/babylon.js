var A=Object.defineProperty;var V=(i,t,e)=>t in i?A(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var l=(i,t,e)=>V(i,typeof t!="symbol"?t+"":t,e);import{r,_ as s,R as y,G as H,O as M,S as K,a as S,Q as c,V as u,E as k,A as F,M as X,b as z,C as Y,c as U,I as Q,d as G,e as O,f as j,g as q,h as Z}from"./babylonjs.js";import{D as N}from"./luxon.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();function $(){r("EXT_lights_image_based",!0,async i=>{const{EXT_lights_image_based:t}=await s(async()=>{const{EXT_lights_image_based:e}=await import("./babylonjs.js").then(n=>n.j);return{EXT_lights_image_based:e}},[]);return new t(i)}),r("EXT_mesh_gpu_instancing",!0,async i=>{const{EXT_mesh_gpu_instancing:t}=await s(async()=>{const{EXT_mesh_gpu_instancing:e}=await import("./babylonjs.js").then(n=>n.k);return{EXT_mesh_gpu_instancing:e}},[]);return new t(i)}),r("EXT_meshopt_compression",!0,async i=>{const{EXT_meshopt_compression:t}=await s(async()=>{const{EXT_meshopt_compression:e}=await import("./babylonjs.js").then(n=>n.l);return{EXT_meshopt_compression:e}},[]);return new t(i)}),r("EXT_texture_avif",!0,async i=>{const{EXT_texture_avif:t}=await s(async()=>{const{EXT_texture_avif:e}=await import("./babylonjs.js").then(n=>n.m);return{EXT_texture_avif:e}},[]);return new t(i)}),r("EXT_texture_webp",!0,async i=>{const{EXT_texture_webp:t}=await s(async()=>{const{EXT_texture_webp:e}=await import("./babylonjs.js").then(n=>n.n);return{EXT_texture_webp:e}},[]);return new t(i)}),r("ExtrasAsMetadata",!1,async i=>{const{ExtrasAsMetadata:t}=await s(async()=>{const{ExtrasAsMetadata:e}=await import("./babylonjs.js").then(n=>n.o);return{ExtrasAsMetadata:e}},[]);return new t(i)}),r("KHR_animation_pointer",!0,async i=>{const{KHR_animation_pointer:t}=await s(async()=>{const{KHR_animation_pointer:e}=await import("./babylonjs.js").then(n=>n.K);return{KHR_animation_pointer:e}},[]);return new t(i)}),r("KHR_draco_mesh_compression",!0,async i=>{const{KHR_draco_mesh_compression:t}=await s(async()=>{const{KHR_draco_mesh_compression:e}=await import("./babylonjs.js").then(n=>n.p);return{KHR_draco_mesh_compression:e}},[]);return new t(i)}),r("KHR_interactivity",!0,async i=>{const{KHR_interactivity:t}=await s(async()=>{const{KHR_interactivity:e}=await import("./babylonjs.js").then(n=>n.q);return{KHR_interactivity:e}},[]);return new t(i)}),r("KHR_lights_punctual",!0,async i=>{const{KHR_lights:t}=await s(async()=>{const{KHR_lights:e}=await import("./babylonjs.js").then(n=>n.s);return{KHR_lights:e}},[]);return new t(i)}),r("EXT_lights_ies",!0,async i=>{const{EXT_lights_ies:t}=await s(async()=>{const{EXT_lights_ies:e}=await import("./babylonjs.js").then(n=>n.t);return{EXT_lights_ies:e}},[]);return new t(i)}),r("KHR_materials_anisotropy",!0,async i=>{const{KHR_materials_anisotropy:t}=await s(async()=>{const{KHR_materials_anisotropy:e}=await import("./babylonjs.js").then(n=>n.u);return{KHR_materials_anisotropy:e}},[]);return new t(i)}),r("KHR_materials_clearcoat",!0,async i=>{const{KHR_materials_clearcoat:t}=await s(async()=>{const{KHR_materials_clearcoat:e}=await import("./babylonjs.js").then(n=>n.v);return{KHR_materials_clearcoat:e}},[]);return new t(i)}),r("KHR_materials_diffuse_transmission",!0,async i=>{const{KHR_materials_diffuse_transmission:t}=await s(async()=>{const{KHR_materials_diffuse_transmission:e}=await import("./babylonjs.js").then(n=>n.w);return{KHR_materials_diffuse_transmission:e}},[]);return new t(i)}),r("KHR_materials_dispersion",!0,async i=>{const{KHR_materials_dispersion:t}=await s(async()=>{const{KHR_materials_dispersion:e}=await import("./babylonjs.js").then(n=>n.x);return{KHR_materials_dispersion:e}},[]);return new t(i)}),r("KHR_materials_emissive_strength",!0,async i=>{const{KHR_materials_emissive_strength:t}=await s(async()=>{const{KHR_materials_emissive_strength:e}=await import("./babylonjs.js").then(n=>n.y);return{KHR_materials_emissive_strength:e}},[]);return new t(i)}),r("KHR_materials_ior",!0,async i=>{const{KHR_materials_ior:t}=await s(async()=>{const{KHR_materials_ior:e}=await import("./babylonjs.js").then(n=>n.z);return{KHR_materials_ior:e}},[]);return new t(i)}),r("KHR_materials_iridescence",!0,async i=>{const{KHR_materials_iridescence:t}=await s(async()=>{const{KHR_materials_iridescence:e}=await import("./babylonjs.js").then(n=>n.B);return{KHR_materials_iridescence:e}},[]);return new t(i)}),r("KHR_materials_pbrSpecularGlossiness",!0,async i=>{const{KHR_materials_pbrSpecularGlossiness:t}=await s(async()=>{const{KHR_materials_pbrSpecularGlossiness:e}=await import("./babylonjs.js").then(n=>n.D);return{KHR_materials_pbrSpecularGlossiness:e}},[]);return new t(i)}),r("KHR_materials_sheen",!0,async i=>{const{KHR_materials_sheen:t}=await s(async()=>{const{KHR_materials_sheen:e}=await import("./babylonjs.js").then(n=>n.F);return{KHR_materials_sheen:e}},[]);return new t(i)}),r("KHR_materials_specular",!0,async i=>{const{KHR_materials_specular:t}=await s(async()=>{const{KHR_materials_specular:e}=await import("./babylonjs.js").then(n=>n.H);return{KHR_materials_specular:e}},[]);return new t(i)}),r("KHR_materials_transmission",!0,async i=>{const{KHR_materials_transmission:t}=await s(async()=>{const{KHR_materials_transmission:e}=await import("./babylonjs.js").then(n=>n.J);return{KHR_materials_transmission:e}},[]);return new t(i)}),r("KHR_materials_unlit",!0,async i=>{const{KHR_materials_unlit:t}=await s(async()=>{const{KHR_materials_unlit:e}=await import("./babylonjs.js").then(n=>n.L);return{KHR_materials_unlit:e}},[]);return new t(i)}),r("KHR_materials_variants",!0,async i=>{const{KHR_materials_variants:t}=await s(async()=>{const{KHR_materials_variants:e}=await import("./babylonjs.js").then(n=>n.N);return{KHR_materials_variants:e}},[]);return new t(i)}),r("KHR_materials_volume",!0,async i=>{const{KHR_materials_volume:t}=await s(async()=>{const{KHR_materials_volume:e}=await import("./babylonjs.js").then(n=>n.P);return{KHR_materials_volume:e}},[]);return new t(i)}),r("KHR_mesh_quantization",!0,async i=>{const{KHR_mesh_quantization:t}=await s(async()=>{const{KHR_mesh_quantization:e}=await import("./babylonjs.js").then(n=>n.T);return{KHR_mesh_quantization:e}},[]);return new t(i)}),r("KHR_texture_basisu",!0,async i=>{const{KHR_texture_basisu:t}=await s(async()=>{const{KHR_texture_basisu:e}=await import("./babylonjs.js").then(n=>n.U);return{KHR_texture_basisu:e}},[]);return new t(i)}),r("KHR_texture_transform",!0,async i=>{const{KHR_texture_transform:t}=await s(async()=>{const{KHR_texture_transform:e}=await import("./babylonjs.js").then(n=>n.W);return{KHR_texture_transform:e}},[]);return new t(i)}),r("KHR_xmp_json_ld",!0,async i=>{const{KHR_xmp_json_ld:t}=await s(async()=>{const{KHR_xmp_json_ld:e}=await import("./babylonjs.js").then(n=>n.X);return{KHR_xmp_json_ld:e}},[]);return new t(i)}),r("MSFT_audio_emitter",!0,async i=>{const{MSFT_audio_emitter:t}=await s(async()=>{const{MSFT_audio_emitter:e}=await import("./babylonjs.js").then(n=>n.Y);return{MSFT_audio_emitter:e}},[]);return new t(i)}),r("MSFT_lod",!0,async i=>{const{MSFT_lod:t}=await s(async()=>{const{MSFT_lod:e}=await import("./babylonjs.js").then(n=>n.Z);return{MSFT_lod:e}},[]);return new t(i)}),r("MSFT_minecraftMesh",!0,async i=>{const{MSFT_minecraftMesh:t}=await s(async()=>{const{MSFT_minecraftMesh:e}=await import("./babylonjs.js").then(n=>n.$);return{MSFT_minecraftMesh:e}},[]);return new t(i)}),r("MSFT_sRGBFactors",!0,async i=>{const{MSFT_sRGBFactors:t}=await s(async()=>{const{MSFT_sRGBFactors:e}=await import("./babylonjs.js").then(n=>n.a0);return{MSFT_sRGBFactors:e}},[]);return new t(i)}),r("KHR_node_visibility",!0,async i=>{const{KHR_node_visibility:t}=await s(async()=>{const{KHR_node_visibility:e}=await import("./babylonjs.js").then(n=>n.a1);return{KHR_node_visibility:e}},[]);return new t(i)}),r("KHR_node_hoverability",!0,async i=>{const{KHR_node_hoverability:t}=await s(async()=>{const{KHR_node_hoverability:e}=await import("./babylonjs.js").then(n=>n.a2);return{KHR_node_hoverability:e}},[]);return new t(i)}),r("KHR_node_selectability",!0,async i=>{const{KHR_node_selectability:t}=await s(async()=>{const{KHR_node_selectability:e}=await import("./babylonjs.js").then(n=>n.a3);return{KHR_node_selectability:e}},[]);return new t(i)})}function J(){y({...H,createPlugin:async i=>{const{GLTFFileLoader:t}=await s(async()=>{const{GLTFFileLoader:e}=await import("./babylonjs.js").then(n=>n.i);return{GLTFFileLoader:e}},[]);return new t(i[H.name])}}),$(),y({...M,createPlugin:async i=>{const{OBJFileLoader:t}=await s(async()=>{const{OBJFileLoader:e}=await import("./babylonjs.js").then(n=>n.a4);return{OBJFileLoader:e}},[]);return new t(i[M.name])}}),y({...K,createPlugin:async i=>{const{SPLATFileLoader:t}=await s(async()=>{const{SPLATFileLoader:e}=await import("./babylonjs.js").then(n=>n.a5);return{SPLATFileLoader:e}},[]);return new t(i[K.name])}}),y({...S,createPlugin:async()=>{const{STLFileLoader:i}=await s(async()=>{const{STLFileLoader:t}=await import("./babylonjs.js").then(e=>e.a6);return{STLFileLoader:t}},[]);return new i}})}class W{constructor(t){l(this,"video");l(this,"supports",null);l(this,"facingMode",null);l(this,"onVideoResize");this.onVideoResize=t,this.video=document.createElement("video"),this.video.disablePictureInPicture=!0,this.video.autoplay=!1,this.video.controls=!1,this.video.playsInline=!0,document.body.appendChild(this.video),this.video.style.display="none",this.supports=navigator.mediaDevices.getSupportedConstraints();const e={audio:!1,video:{facingMode:"environment"}};navigator.mediaDevices.getUserMedia(e).then(a=>this.handleSuccess(a)).catch(a=>this.handleError(a));const n=document.getElementById("facingModeButton");if(n!=null){const a=o=>{o.preventDefault(),o.stopPropagation()};n.addEventListener("click",async o=>{a(o),this.video.srcObject.getTracks().forEach(g=>g.stop()),this.facingMode=this.facingMode==="user"||this.facingMode==null?"environment":"user";const h={audio:!1,video:this.supports.facingMode?{facingMode:{exact:this.facingMode}}:{}},_=await navigator.mediaDevices.getUserMedia(h).catch(()=>navigator.mediaDevices.getUserMedia({audio:!1,video:!0}));this.video.srcObject=null,this.video.srcObject=_,this.video.play().then(()=>{this.onVideoResize()})})}}handleSuccess(t){this.video.srcObject=t,this.video.play().then(()=>{this.onVideoResize()})}handleError(t){`${t.message}${t.name}`}}class tt{static init(){const t=document.documentElement,e=document.getElementById("fullscreenBtn"),n=document.getElementById("fullscreenOffBtn");e.addEventListener("click",async()=>{e.style.display="none",n.style.display="inline",a()}),n.addEventListener("click",async()=>{e.style.display="inline",n.style.display="none",o()});function a(){t.requestFullscreen?t.requestFullscreen({navigationUI:"hide"}).then():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}function o(){document.exitFullscreen?document.exitFullscreen().then():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}}}class et{constructor(t,e){l(this,"buttonState",3);l(this,"startPointerX",0);l(this,"startPointerY",0);l(this,"lastPointerX",0);l(this,"lastPointerY",0);l(this,"mesh");l(this,"originalRotation");l(this,"onChanged");l(this,"evCache",[]);l(this,"prevDiff",-1);l(this,"preventDefault",t=>{t.preventDefault(),t.stopPropagation()});l(this,"canvas",null);this.onChanged=e,this.mesh=t,this.originalRotation=t.rotationQuaternion??c.FromEulerVector(new u(0,0,0))}onPointerMove(t){const e=t.clientX-this.lastPointerX,n=t.clientY-this.lastPointerY;switch(this.buttonState){case 0:this.mesh.position=this.mesh.position.add(new u(e*.01,-n*.01,0));break;case 2:this.mesh.rotationQuaternion=new c((this.startPointerY-t.clientY)*.005,(this.startPointerX-t.clientX)*.005,0,1).multiply(this.originalRotation).normalize();break;case 1:this.mesh.scaling=this.mesh.scaling.add(new u(-n*.01,-n*.01,-n*.01));break}this.lastPointerX=t.clientX,this.lastPointerY=t.clientY,this.onChanged()}onPointerDown(t){switch(t.button){case 0:this.buttonState=0;break;case 1:this.buttonState=1;break;case 2:this.buttonState=2;break}}onPointerUp(){this.originalRotation=this.mesh.rotationQuaternion??c.Zero(),this.buttonState=3}pointerdown_handler(t){this.evCache.push(t),this.evCache.length==1?(this.startPointerX=this.lastPointerX=t.clientX,this.startPointerY=this.lastPointerY=t.clientY,this.onPointerDown(t)):this.evCache.length==3&&(this.startPointerX=this.lastPointerX=(this.evCache[2].clientX+this.evCache[1].clientX+this.evCache[0].clientX)/2,this.startPointerY=this.lastPointerY=(this.evCache[2].clientY+this.evCache[1].clientY+this.evCache[0].clientY)/2),this.preventDefault(t)}pointermove_handler(t){for(let e=0;e<this.evCache.length;e++)if(t.pointerId==this.evCache[e].pointerId){this.evCache[e]=t;break}if(this.evCache.length==1)this.onPointerMove(this.evCache[0]);else if(this.evCache.length==3){const e=(this.evCache[2].clientX+this.evCache[1].clientX+this.evCache[0].clientX)/2,n=(this.evCache[2].clientY+this.evCache[1].clientY+this.evCache[0].clientY)/2;this.mesh.rotationQuaternion=new c((this.startPointerY-n)*.005,(this.startPointerX-e)*.005,0,1).multiply(this.originalRotation).normalize(),this.onChanged()}else if(this.evCache.length==2){const e=Math.sqrt(Math.pow(this.evCache[1].clientX-this.evCache[0].clientX,2)+Math.pow(this.evCache[1].clientY-this.evCache[0].clientY,2));if(this.prevDiff>0){const n=(e-this.prevDiff)*.005;this.mesh.scaling=this.mesh.scaling.add(new u(n,n,n))}this.prevDiff=e,this.onChanged()}this.preventDefault(t)}pointerup_handler(t){this.remove_event(t),this.evCache.length<3&&(this.prevDiff=-1),this.evCache.length==0&&this.onPointerUp(),this.preventDefault(t)}remove_event(t){for(let e=0;e<this.evCache.length;e++)if(this.evCache[e].pointerId==t.pointerId){this.evCache.splice(e,1);break}}attachToCanvas(t){this.canvas=t,t.onpointerdown=e=>this.pointerdown_handler(e),t.onpointermove=e=>this.pointermove_handler(e),t.onpointerup=e=>this.pointerup_handler(e),t.onpointercancel=e=>this.pointerup_handler(e),t.onpointerout=e=>this.pointerup_handler(e),t.onpointerleave=e=>this.pointerup_handler(e),t.oncontextmenu=e=>this.preventDefault(e),t.ondragover=e=>this.preventDefault(e),t.ondragenter=e=>this.preventDefault(e),t.ondragleave=e=>this.preventDefault(e)}dispose(){this.canvas!=null&&(this.canvas.onpointerdown=null,this.canvas.onpointermove=null,this.canvas.onpointerup=null,this.canvas.onpointercancel=null,this.canvas.onpointerout=null,this.canvas.onpointerleave=null)}}class nt{constructor(t,e="",n="black"){l(this,"_engine",null);l(this,"_resizeObserver",null);l(this,"_isLoading",!1);l(this,"_loadingDivToRenderingCanvasMap",new Map);l(this,"_loadingTextDiv",null);l(this,"_resizeLoadingUI",()=>{this._isLoading&&this._loadingDivToRenderingCanvasMap.forEach(([t,e],n)=>{const a=t.getBoundingClientRect();if(this._isCanvasLayoutChanged(e,a)){const o=window.getComputedStyle(t).position;n.style.position=o==="fixed"?"fixed":"absolute",n.style.left=a.left+window.scrollX+"px",n.style.top=a.top+window.scrollY+"px",n.style.width=a.width+"px",n.style.height=a.height+"px",this._loadingDivToRenderingCanvasMap.set(n,[t,a])}})});this._renderingCanvas=t,this._loadingText=e,this._loadingDivBackgroundColor=n}displayLoadingUI(){if(this._isLoading)return;this._isLoading=!0,this._engine=k.Instances.find(a=>a.getRenderingCanvas()===this._renderingCanvas);const t=document.createElement("div");t.id="babylonjsLoadingDiv",t.style.opacity="0",t.style.transition="opacity 1.5s ease",t.style.pointerEvents="none",t.style.display="grid",t.style.gridTemplateRows="100%",t.style.gridTemplateColumns="100%",t.style.justifyItems="center",t.style.alignItems="center",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="0px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="32px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.style.zIndex="1",t.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText,t.style.backgroundColor=this._loadingDivBackgroundColor,t.style.opacity="1";const e=[],n=this._engine.views;if(n!=null&&n.length)for(const a of n)a.enabled&&e.push(a.target);else e.push(this._renderingCanvas);for(let a=0;a<e.length;a++){const o=e[a],d=t.cloneNode(!0);d.id+=`-${a}`,this._loadingDivToRenderingCanvasMap.set(d,[o,null])}this._resizeLoadingUI(),this._resizeObserver=this._engine.onResizeObservable.add(()=>{this._resizeLoadingUI()}),this._loadingDivToRenderingCanvasMap.forEach((a,o)=>{document.body.appendChild(o)})}hideLoadingUI(){if(!this._isLoading)return;let t=0;const e=n=>{const a=n.target;this._loadingDivToRenderingCanvasMap.has(a)&&(t++,a.remove(),t===this._loadingDivToRenderingCanvasMap.size&&(this._loadingTextDiv&&(this._loadingTextDiv.remove(),this._loadingTextDiv=null),window.removeEventListener("transitionend",e),this._engine.onResizeObservable.remove(this._resizeObserver),this._loadingDivToRenderingCanvasMap.clear(),this._engine=null,this._isLoading=!1))};this._loadingDivToRenderingCanvasMap.forEach((n,a)=>{a.style.opacity="0"}),window.addEventListener("transitionend",e)}set loadingUIText(t){this._loadingText=t,this._loadingTextDiv&&this._loadingDivToRenderingCanvasMap.forEach((e,n)=>{n.children[0].innerHTML=this._loadingText})}get loadingUIText(){return this._loadingText}get loadingUIBackgroundColor(){return this._loadingDivBackgroundColor}set loadingUIBackgroundColor(t){this._loadingDivBackgroundColor=t,this._isLoading&&this._loadingDivToRenderingCanvasMap.forEach((e,n)=>{n.style.backgroundColor=this._loadingDivBackgroundColor})}_isCanvasLayoutChanged(t,e){return!t||t.left!==e.left||t.top!==e.top||t.right!==e.right||t.bottom!==e.bottom||t.width!==e.width||t.height!==e.height||t.x!==e.x||t.y!==e.y}}class it{constructor(t,e,n=.03,a=.1,o=.2,d=-Math.PI/2,h=Math.PI/2,_=10,g=u.Zero()){const m=document.getElementById("toggleControlsButton"),v=document.getElementById("resetButton"),f=document.getElementById("controlButtons"),w=document.getElementById("moveLeftButton"),E=document.getElementById("moveRightButton"),R=document.getElementById("moveTopButton"),T=document.getElementById("moveBottomButton"),L=document.getElementById("rotateTopButton"),D=document.getElementById("rotateBottomButton"),I=document.getElementById("rotateLeftButton"),C=document.getElementById("rotateRightButton"),P=document.getElementById("rotateFrontButton"),B=document.getElementById("rotateBackButton"),b=document.getElementById("zoomInButton"),x=document.getElementById("zoomOutButton");let p=!1;m!=null&&(m.style.display="block",m.addEventListener("click",()=>{p=!p,m.style.filter=p?"grayscale(100%)":"none",f&&(f.style.display=p?"block":"none"),v&&(v.style.display=p?"block":"none")})),e.rotation=e.rotation,v!=null&&v.addEventListener("click",()=>{confirm("Reset layout to default?")&&(t&&t.activeCamera instanceof F&&(t.activeCamera.alpha=d,t.activeCamera.beta=h,t.activeCamera.radius=_,t.activeCamera.target=g),e&&(e.setPivotMatrix(X.Identity()),e.position=u.Zero(),e.rotation=u.Zero(),e.scaling=new u(1,1,1),e.computeWorldMatrix(!0)))}),w!=null&&w.addEventListener("click",()=>{e.position.x-=n}),E!=null&&E.addEventListener("click",()=>{e.position.x+=n}),R!=null&&R.addEventListener("click",()=>{e.position.y+=n}),T!=null&&T.addEventListener("click",()=>{e.position.y-=n}),L!=null&&L.addEventListener("click",()=>{e.rotationQuaternion=new c(a,0,0,1).multiply(e.rotationQuaternion??c.FromEulerVector(u.Zero())).normalize()}),D!=null&&D.addEventListener("click",()=>{e.rotationQuaternion=new c(-a,0,0,1).multiply(e.rotationQuaternion??c.FromEulerVector(u.Zero())).normalize()}),I!=null&&I.addEventListener("click",()=>{e.rotationQuaternion=new c(0,a,0,1).multiply(e.rotationQuaternion??c.FromEulerVector(u.Zero())).normalize()}),C!=null&&C.addEventListener("click",()=>{e.rotationQuaternion=new c(0,-a,0,1).multiply(e.rotationQuaternion??c.FromEulerVector(u.Zero())).normalize()}),P!=null&&P.addEventListener("click",()=>{e.rotationQuaternion=new c(0,0,a,1).multiply(e.rotationQuaternion??c.FromEulerVector(u.Zero())).normalize()}),B!=null&&B.addEventListener("click",()=>{e.rotationQuaternion=new c(0,0,-a,1).multiply(e.rotationQuaternion??c.FromEulerVector(u.Zero())).normalize()}),b!=null&&b.addEventListener("click",()=>{e.position.z-=o}),x!=null&&x.addEventListener("click",()=>{e.position.z+=o})}}class at{constructor(){l(this,"videoEngine",null);l(this,"videoTexture",null);l(this,"renderCanvas");l(this,"engine",null);l(this,"scene",null);l(this,"splat",null);l(this,"inputEngine",null);l(this,"loadingScreen");l(this,"plane",null);l(this,"splat_frame_id",null);J(),this.renderCanvas=document.getElementById("renderCanvas"),this.loadingScreen=new nt(this.renderCanvas,"Loading. Could take a while.","black"),this.engine=new z(this.renderCanvas,!1,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1}),this.createScene(),this.engine.loadingScreen=this.loadingScreen,this.engine.displayLoadingUI(),this.scene.autoClearDepthAndStencil=!0,this.scene.clearColor=new Y(0,0,0,0),tt.init();const t=this.engine,e=n=>{this.alignPlane(n)};window.addEventListener("resize",function(){t==null||t.resize(),e("resize")})}renderScene(){this.splat_frame_id!=null&&cancelAnimationFrame(this.splat_frame_id),this.splat_frame_id=requestAnimationFrame(()=>{var t;(t=this.videoTexture)==null||t.update(),this.renderFrame()})}renderFrame(){this.scene!=null&&this.scene.activeCamera&&this.scene.render(!1,!0)}async captureSplat(t){const e={width:this.renderCanvas.width,height:this.renderCanvas.height},n=this.screenshotSize(this.renderCanvas.width,this.renderCanvas.height);this.renderCanvas.width=n.width,this.renderCanvas.height=n.height,t.render(!1,!0),this.renderCanvas.toBlob(a=>{const o=document.createElement("a");o.href=URL.createObjectURL(a),o.download=`splat_${N.now().toFormat("yyyy_LL_dd_HH_mm_ss")}.jpg`,o.click()},"image/jpeg",1),this.renderCanvas.width=e.width,this.renderCanvas.height=e.height}createScene(){this.scene=new U(this.engine);const t=new F("Camera",-Math.PI/2,Math.PI/2,20,new u(0,0,0),this.scene);t.useFramingBehavior=!0,Q(document.getElementById("splat_url").value,this.scene).then(n=>{this.onSceneLoaded(n)});const e=document.getElementById("screenshotBtn");e!=null&&e.addEventListener("click",async()=>{this.splat!=null&&await this.captureSplat(this.scene)})}onSceneLoaded(t){var a;this.splat=t.meshes[0],(a=this.engine)==null||a.hideLoadingUI(),document.getElementById("mainButtons").style.display="flex",this.splat.position.set(0,0,-10),this.splat.scaling.set(1,1,1),this.splat.rotationQuaternion=c.FromEulerVector(new u(0,0,0)),this.videoEngine=new W(()=>{this.alignPlane("video engine callback")}),this.videoTexture=new G("vt",this.videoEngine.video,this.scene,!1,!1,O.TEXTURE_BILINEAR_SAMPLINGMODE,{autoPlay:!0,independentVideoSource:!0,autoUpdateTexture:!0}),this.plane=j.CreatePlane("plane",{width:1,height:1},this.scene),this.plane.billboardMode=q.BILLBOARDMODE_ALL;const e=new Z("rtt",this.scene);e.transparencyMode=3,e.alphaMode=O.ALPHA_COMBINE,e.emissiveTexture=this.videoTexture,e.disableLighting=!0,this.plane.material=e,this.inputEngine=new et(this.splat,()=>{this.renderScene()});const n=this.inputEngine;this.scene.onDispose=function(){n==null||n.dispose()},this.inputEngine.attachToCanvas(this.renderCanvas),this.engine!=null&&this.engine.runRenderLoop(()=>this.renderFrame()),new it(this.scene,this.splat)}alignPlane(t){if(this.scene!=null&&this.engine!=null&&this.plane!=null&&this.videoEngine!=null){const e=this.scene.activeCamera;if(e!=null){const n=e.fov,a=this.engine.getAspectRatio(e),d=2*e.position.length()*Math.tan(n/2),h=d*a,_=this.videoSize(this.videoEngine.video.videoWidth,this.videoEngine.video.videoHeight,h,d);`${t}${JSON.stringify(_)}`,this.plane.scaling.set(_.width,_.height,1)}}}videoSize(t,e,n,a){const o=t/e,d=n/a;let h,_,g,m;return o>d?(g=a*o,m=a,h=(n-g)/2,_=0):(g=n,m=n/o,h=0,_=(a-m)/2),{x:h,y:_,width:g,height:m}}screenshotSize(t,e,n=2160){return t>e?{width:n,height:e*n/t}:{width:t*n/e,height:n}}}new at;
